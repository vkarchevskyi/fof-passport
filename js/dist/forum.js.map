{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/passport/webpack/bootstrap","webpack://@fof/passport/webpack/runtime/compat get default export","webpack://@fof/passport/webpack/runtime/define property getters","webpack://@fof/passport/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/passport/webpack/runtime/make namespace object","webpack://@fof/passport/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/LogInButtons']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/LogInButton']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/HeaderSecondary']\"","webpack://@fof/passport/external root \"flarum.core.compat['common/components/EditUserModal']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/SignUpModal']\"","webpack://@fof/passport/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@fof/passport/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@fof/passport/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButtons'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/EditUserModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SignUpModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","import { extend, override } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport LogInButtons from 'flarum/forum/components/LogInButtons';\nimport LogInButton from 'flarum/forum/components/LogInButton';\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\nimport EditUserModal from 'flarum/common/components/EditUserModal';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport SignUpModal from 'flarum/forum/components/SignUpModal';\nimport Stream from 'flarum/common/utils/Stream';\nimport LogInModal from 'flarum/forum/components/LogInModal';\n\napp.initializers.add('vkarchevskyi-fof-passport', () => {\n  extend(LogInButtons.prototype, 'items', function (items) {\n    items.add(\n      'vkarchevskyi-fof-passport',\n      LogInButton.component(\n        {\n          className: 'Button LogInButton--passport',\n          icon: app.forum.attribute('vkarchevskyi-fof-passport.loginIcon'),\n          path: '/auth/passport',\n        },\n        app.forum.attribute('vkarchevskyi-fof-passport.loginTitle')\n      )\n    );\n  });\n\n  override(HeaderSecondary.prototype, 'items', function (original) {\n    const items = original();\n\n    if (items.has('logIn')) {\n      items.setContent(\n        'logIn',\n        LogInButton.component(\n          {\n            className: 'LinksButton Button Button--link LogInButton--passport',\n            path: '/auth/passport',\n          },\n          'Log In'\n        )\n      );\n    }\n\n    if (items.has('signUp')) {\n      items.setContent(\n        'signUp',\n        LogInButton.component(\n          {\n            className: 'LinksButton Button Button--link SignUpButton--passport',\n            path: '/auth/passport?to_registration=1',\n          },\n          'Sign Up'\n        )\n      );\n    }\n\n    return items;\n  });\n\n  override(EditUserModal.prototype, 'fields', (original) => {\n    const items = original();\n\n    if (!app.session.user.isAdmin()) {\n      items.remove('username');\n    }\n\n    return items;\n  });\n\n  override(IndexPage.prototype, 'newDiscussionAction', function () {\n    return new Promise((resolve, reject) => {\n      if (app.session.user) {\n        app.composer.load(DiscussionComposer, { user: app.session.user });\n        app.composer.show();\n\n        return resolve(app.composer);\n      } else {\n        document.querySelector('.LogInButton--passport').click();\n\n        return reject();\n      }\n    });\n  });\n\n  override(SignUpModal.prototype, 'oninit', function (original, vnode) {\n    original(vnode);\n\n    if (app.forum.attribute('displayNameDriver') !== 'nickname') return;\n\n    console.log(this.attrs);\n\n    this.originalNickname = Stream(this.attrs.nickname || '');\n  });\n\n  override(SignUpModal.prototype, 'onsubmit', function (original, e) {\n    e.preventDefault();\n\n    this.loading = true;\n\n    const body = this.submitData();\n    body.nickname = this.originalNickname();\n\n    console.log(body);\n\n    app\n      .request({\n        url: app.forum.attribute('baseUrl') + '/register',\n        method: 'POST',\n        body,\n        errorHandler: this.onerror.bind(this),\n      })\n      .then(() => window.location.reload(), this.loaded.bind(this));\n  });\n\n  override(LogInModal.prototype, 'oninit', () => {\n    document.querySelector('.Button.LogInButton--passport').click();\n    document.querySelector('body').style.display = 'block';\n    document.querySelector('#modal').remove();\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","extend","LogInButtons","items","LogInButton","className","icon","attribute","path","override","HeaderSecondary","original","has","setContent","EditUserModal","user","isAdmin","remove","IndexPage","Promise","resolve","reject","load","DiscussionComposer","show","document","querySelector","click","SignUpModal","vnode","console","log","this","attrs","originalNickname","Stream","nickname","e","preventDefault","loading","body","submitData","url","method","errorHandler","onerror","bind","then","window","location","reload","loaded","LogInModal","style","display"],"sourceRoot":""}